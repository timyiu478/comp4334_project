(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{103:function(e,t,a){e.exports={App:"styles_App__TyUD5",AppLogo:"styles_AppLogo__11Cd7",AppHeader:"styles_AppHeader__9cOl4",AppLink:"styles_AppLink__XmAu_"}},226:function(e,t,a){e.exports=a.p+"static/media/logo.25bf045c.svg"},244:function(e,t,a){e.exports=a(385)},249:function(e,t,a){},255:function(e,t){},257:function(e,t){},267:function(e,t){},269:function(e,t){},28:function(e,t,a){e.exports={container:"styles_container__1ULzN",background:"styles_background__3xe4F",chat_container:"styles_chat_container__qXZl3",logOut:"styles_logOut__1o5Ck",contactListClickable:"styles_contactListClickable__wOj_H",chat_header:"styles_chat_header__1FztM",chat_app_container:"styles_chat_app_container__2UTck",chat_app_contactList_container:"styles_chat_app_contactList_container__2ZOOH",chat_app_contactList_contact:"styles_chat_app_contactList_contact__j_ohW",chat_app_body:"styles_chat_app_body__3aOKz",chat_app_msg_container:"styles_chat_app_msg_container__1_IFm",chat_app_contact:"styles_chat_app_contact__3kp1r",chat_app_msg_inMsg:"styles_chat_app_msg_inMsg__1E-so",chat_app_msg_outMsg:"styles_chat_app_msg_outMsg__vPeaQ",chat_app_footer:"styles_chat_app_footer__19GoJ",msg_scrollbar:"styles_msg_scrollbar__219Dq",refresh_token_button:"styles_refresh_token_button__2Z39q"}},296:function(e,t){},298:function(e,t){},299:function(e,t){},304:function(e,t){},306:function(e,t){},312:function(e,t){},314:function(e,t){},333:function(e,t){},345:function(e,t){},348:function(e,t){},385:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(39),c=a.n(o),s=(a(249),a(95)),l=a(22),i=a(17),u=a(18),p=a(20),m=a(19),_=(r.a.PureComponent,a(14)),g=a(56),f=a.n(g),d=a(452),h=a(449),y=a(455),b=a(448),v=a(458),E=a(461),O=a(459),S=a(460),k=a(446),j=a(87),w=a.n(j);function N(e){return JSON.stringify({coeff:e.coeff.toString(16),d:e.d.toString(16),dmp1:e.dmp1.toString(16),dmq1:e.dmq1.toString(16),e:e.e.toString(16),n:e.n.toString(16),p:e.p.toString(16),q:e.q.toString(16)})}function x(e,t){var a=e+t+"407e0fce8fcb1cee870e19575260b6f2";return w.a.generateRSAKey(a,1024)}var C=a(44),T=a.n(C),A=a(113),R=function(e){var t=e.open,a=e.setOpen,o=Object(n.useState)(""),c=Object(_.a)(o,2),s=c[0],l=c[1],i=Object(n.useState)(""),u=Object(_.a)(i,2),p=u[0],m=u[1],g=function(e){"username"==e.target.id&&l(e.target.value),"password"==e.target.id&&m(e.target.value)},f=function(){a(!1)};return r.a.createElement("div",null,r.a.createElement(v.a,{open:t,onClose:f},r.a.createElement(k.a,null,"Register"),r.a.createElement(O.a,null,r.a.createElement(S.a,null,"To register to this website, please enter your username and also password here."),r.a.createElement(b.a,{autoFocus:!0,margin:"normal",id:"username",label:"Username",type:"text",fullWidth:!0,variant:"standard",value:s,onChange:g}),r.a.createElement(b.a,{autoFocus:!0,margin:"normal",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"standard",value:p,onChange:g})),r.a.createElement(E.a,null,r.a.createElement(y.a,{onClick:f},"Cancel"),r.a.createElement(y.a,{onClick:function(){var e,t=x(s,p),a=(e=t,w.a.publicKeyString(e)),n=new A.Sha256;n.update(p);var r=n.digest(),o={username:s,password:r,public_key:a};T.a.ajax({method:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(o),url:"/api/signup/",success:function(e,a){console.log(e),localStorage.setItem("SenderRSAkey",N(t)),localStorage.setItem("username",s),alert(e.msg)},error:function(e,t){console.log(e),alert(e.responseJSON.msg)}}),localStorage.setItem("SenderRSAkey",N(t)),localStorage.setItem("username",s)}},"Register"))))},L=function(){var e=Object(n.useState)(!1),t=Object(_.a)(e,2),a=t[0],o=t[1],c=Object(l.g)(),s=Object(n.useState)(""),i=Object(_.a)(s,2),u=i[0],p=i[1],m=Object(n.useState)(""),g=Object(_.a)(m,2),y=g[0],b=g[1],v=function(e){"username"==e.target.id&&p(e.target.value),"password"==e.target.id&&b(e.target.value)};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:f.a.container},r.a.createElement(R,{open:a,setOpen:o}),r.a.createElement("div",{className:f.a.background}),r.a.createElement("div",{className:f.a.content},r.a.createElement("div",{className:f.a.register,role:"button",onClick:function(){o(!0)}},"Register"),r.a.createElement(d.a,{className:f.a.form},r.a.createElement("h1",{className:f.a.heading},"Login"),r.a.createElement("div",{className:f.a.input},r.a.createElement("label",{htmlFor:"name"},"Login Name"),r.a.createElement("input",{type:"text",name:"username",id:"username",autoComplete:"none",value:u,onChange:v})),r.a.createElement("div",{className:f.a.input},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",name:"password",id:"password",value:y,onChange:v})),r.a.createElement("div",{className:f.a.submitContainer},r.a.createElement(h.a,{variant:"contained",onClick:function(){var e=x(u,y),t=new A.Sha256;t.update(y);var a=t.digest(),n={username:u,h_pw:a};T.a.ajax({method:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(n),url:"/api/login/",success:function(t,a){localStorage.setItem("SenderRSAkey",N(e)),localStorage.setItem("username",u),console.log(t),c.push("/chatpage")},error:function(e,t){console.log(e),alert("Invalid Username or Password.")}})}},"Login"))))))},F=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"componentDidUpdate",value:function(e){this.props.location.pathname!==e.location.pathname&&window.scrollTo(0,0)}},{key:"render",value:function(){return null}}]),a}(r.a.Component),P=a(42),I=a.n(P),J=a(72),U=a(24),K=a(28),q=a.n(K),B=a(454),M=a(457),H=a(225),X=a.n(H),z=a(221),W=a(74),D=a.n(W),G=a(73),V=a.n(G);function Z(e,t,a){var n,r=D.a.utils.hex.toBytes(e.data.msg);n=e.data.to==t?e.data.msg_info:e.data.msg_info_for_sender;var o=cryptico.decrypt(n.cipher,a);if("failure"==o.status)return!1;o=o.plaintext;var c=(o=JSON.parse(o)).aes,s=new D.a.ModeOfOperation.cbc(new Uint8Array(c.key_256.split(",")),new Uint8Array(c.iv.split(","))).decrypt(r);return D.a.utils.utf8.fromBytes(s).slice(0,o.msg_length)}function Q(){T.a.ajax({method:"GET",dataType:"json",headers:{"X-CSRF-TOKEN":V.a.get("csrf_access_token")},url:"/api/token/refresh",success:function(e,t){alert("Refresh Token Successfully!")},error:function(e,t,a){console.log(e),console.log(t),console.log(a),alert("Refresh Token Failed!")}})}function Y(e,t,a){return $.apply(this,arguments)}function $(){return($=Object(J.a)(I.a.mark((function e(t,a,n){var r,o,c,s=arguments;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>3&&void 0!==s[3]?s[3]:0,o={target:t,start_message_index:r},c=[],e.next=5,T.a.ajax({method:"POST",dataType:"json",contentType:"application/json",headers:{"X-CSRF-TOKEN":V.a.get("csrf_access_token")},data:JSON.stringify(o),url:"/api/history/",success:function(e,t){for(var r=e.msgs,o=0;o<r.length;o++){var s=Z(r[o],a,n);0!=s&&c.push({msg:s,date:r[o].datetime,to:r[o].data.to})}return c},error:function(e,t,a){return console.log(e),console.log(t),console.log(a),"error: ajax failed"}});case 5:return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(J.a)(I.a.mark((function e(t){var a,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={username:t},n="",e.next=5,T.a.ajax({method:"POST",dataType:"text",contentType:"application/json",headers:{"X-CSRF-TOKEN":V.a.get("csrf_access_token")},data:JSON.stringify(a),url:"/api/public_keys/",success:function(e,t){return n=e,e},error:function(e,t,a){console.log(e),console.log(t),console.log(a)}});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){if(e.length%16!=0){var t=e.length%16,a=new Uint8Array(16-t);a=crypto.getRandomValues(a);for(var n="",r=0;r<a.length;r++)n+=String.fromCharCode((a[r]+32)%127);return e+n}return e}function ne(e,t,a,n,r){return re.apply(this,arguments)}function re(){return(re=Object(J.a)(I.a.mark((function e(t,a,n,r,o){var c,s,l,i,u,p,m,_,g,f,d;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=crypto.getRandomValues(new Uint8Array(32)),s=crypto.getRandomValues(new Uint8Array(16)),l=D.a.utils.utf8.toBytes(ae(t)),i=new D.a.ModeOfOperation.cbc(c,s),u=i.encrypt(l),p=D.a.utils.hex.fromBytes(u),m={key_256:c.toString(),iv:s.toString()},_={to:a,msg_length:t.length,aes:m},g=cryptico.encrypt(JSON.stringify(_),n,r),f=cryptico.encrypt(JSON.stringify(_),o),d={msg:p,msg_info:g,msg_info_for_sender:f,to:a},e.abrupt("return",d);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=a(227).a.connect("wss://"+location.host,{transports:["websocket"],rememberUpgrade:!0,cors:{origin:"*"},credentials:!0,methods:["GET","POST"]}),ce=function(){!1===oe.connected&&!1===oe.connecting?(console.log("tryReconnect..."),oe.connect(),oe.emit("join",{})):console.log("connected")},se=function(){var e=Object(n.useRef)(null),t=Object(l.g)(),a=Object(n.useState)([]),o=Object(_.a)(a,2),c=o[0],s=o[1],i=Object(n.useState)([]),u=Object(_.a)(i,2),p=u[0],m=u[1],g=localStorage.getItem("username"),f=Object(n.useState)(""),d=Object(_.a)(f,2),h=d[0],y=d[1],b=Object(n.useState)(""),v=Object(_.a)(b,2),E=v[0],O=v[1],S=Object(n.useState)(""),k=Object(_.a)(S,2),N=k[0],x=k[1],C=function(e){var t=JSON.parse(e),a=new j.RSAKey;return a.setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dmp1,t.dmq1,t.coeff),a}(localStorage.getItem("SenderRSAkey")),A=w.a.publicKeyString(C),R=localStorage.getItem("username"),L={};oe.emit("join",{}),Object(n.useEffect)((function(){setInterval(ce,3e4)}),[]),oe.on("message",(function(t){var a=Z(t,R,C),n=t.from;n!=E&&n!=g||(s([].concat(Object(U.a)(c),[{msg:a,date:t.datetime,to:t.data.to}])),e.current.scrollToBottom())}));var F=function(){var e=Object(J.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(""),ne(h,E,N,C,A).then((function(e){oe.emit("message",e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){T.a.ajax({method:"GET",dataType:"json",headers:{"X-CSRF-TOKEN":V.a.get("csrf_access_token")},url:"/api/usernames/",success:function(e,t){m(e.usernames.filter((function(e){return e!==g})))},error:function(e,t){}})}),[]);var P=function(){var t=Object(J.a)(I.a.mark((function t(a){var n;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=p[a.target.id],O(n),!L.hasOwnProperty(n)){t.next=6;break}x(L[n]),t.next=8;break;case 6:return t.next=8,ee(n).then((function(e){x(e),L[n]=e}));case 8:return t.next=10,Y(n,R,C).then((function(e){s(e)}));case 10:e.current.scrollToBottom();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:q.a.container,onKeyDown:function(e){"Enter"===e.key&&F()}},r.a.createElement("div",{className:q.a.background}),r.a.createElement("div",{className:q.a.chat_container},r.a.createElement("div",{className:q.a.logOut},r.a.createElement(M.a,{"aria-label":"LogOut",size:"small",onClick:function(){T.a.ajax({method:"GET",url:"/api/logout/",headers:{"X-CSRF-TOKEN":V.a.get("csrf_access_token")},success:function(e,a){t.push("/")},error:function(e,t){}})}},r.a.createElement(X.a,{fontSize:"inherit"}),"LogOut")),r.a.createElement("div",{className:q.a.chat_header},r.a.createElement("h1",null,"ChatPage"),r.a.createElement("h5",null,"Welcome! ",g)),r.a.createElement("div",{className:q.a.chat_app_container},r.a.createElement("div",{className:q.a.chat_app_contactList_container},p!==[]&&p.map((function(e,t){return r.a.createElement("li",{key:t,id:t,className:q.a.chat_app_contactList_contact,onClick:P},e)})),r.a.createElement("button",{onClick:Q,className:q.a.refresh_token_button},"Refresh Token")),r.a.createElement("div",{className:q.a.chat_app_body},r.a.createElement("div",{className:q.a.chat_app_contact},r.a.createElement("h3",null,"Current Contact: ",""!==E&&E)),r.a.createElement("div",{className:q.a.chat_app_msg_container},r.a.createElement(z.Scrollbars,{ref:e,className:q.a.msg_scrollbar,universal:!0,autoHide:!0,autoHideTimeout:1e3,autoHideDuration:200},c!==[]&&c.map((function(e){return r.a.createElement("p",{className:e.to===g?q.a.chat_app_msg_inMsg:q.a.chat_app_msg_outMsg},r.a.createElement("p",null,e.msg),r.a.createElement("span",null,e.date))})))),r.a.createElement("div",{className:q.a.chat_app_footer},r.a.createElement("input",{placeholder:" Enter message...",type:"text",value:h,onChange:function(e){y(e.target.value)}}),r.a.createElement("button",{onClick:F,type:"button"},r.a.createElement(B.a,null))))))))},le=a(226),ie=a.n(le),ue=a(103),pe=a.n(ue),me=(r.a.PureComponent,"/login"),_e="/chatpage",ge=function(){return r.a.createElement(s.a,null,r.a.createElement(F,null),r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",component:L}),r.a.createElement(l.b,{exact:!0,path:me,component:L}),r.a.createElement(l.b,{exact:!0,path:_e,component:se}),r.a.createElement(l.a,{from:"*",to:"/"})))};var fe=function(){return r.a.createElement(ge,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(fe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},56:function(e,t,a){e.exports={container:"styles_container__1qw04",background:"styles_background__1hcBy",content:"styles_content__2QTT4",register:"styles_register__1t3Ar",form:"styles_form__hyzsE",heading:"styles_heading__3AtM5",input:"styles_input__VZBS5",submitContainer:"styles_submitContainer__3Y4x4"}}},[[244,1,2]]]);